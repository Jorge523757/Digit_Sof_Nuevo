{% extends 'main/gestion/base_gestion.html' %}

{% block header_icon %}<i class="fas fa-clipboard-list"></i>{% endblock %}

{% block stats_section %}
<div class="stats-cards">
    <div class="stat-card">
        <div class="stat-number">{{ total_ordenes }}</div>
        <div class="stat-label">Total Órdenes</div>
    </div>
    <div class="stat-card">
        <div class="stat-number">{{ ordenes_pendientes }}</div>
        <div class="stat-label">Pendientes</div>
    </div>
    <div class="stat-card">
        <div class="stat-number">{{ ordenes_completadas }}</div>
        <div class="stat-label">Completadas</div>
    </div>
</div>
{% endblock %}

{% block table_icon %}<i class="fas fa-clipboard-list"></i>{% endblock %}
{% block table_title %}Órdenes de Servicio{% endblock %}

{% block table_content %}
{% if ordenes_data %}
<table class="data-table">
    <thead>
        <tr>
            <th>ID</th>
            <th>Cliente</th>
            <th>Técnico</th>
            <th>Descripción</th>
            <th>Estado</th>
            <th>Fecha</th>
            <th>Servicios</th>
            <th>Facturas</th>
            <th>Acciones</th>
        </tr>
    </thead>
    <tbody>
        {% for item in ordenes_data %}
        <tr>
            <td><strong>#{{ item.orden.id_ordenServicio }}</strong></td>
            <td>
                <strong>{{ item.orden.cliente.nombre }}</strong>
                <br>
                <small class="text-muted">{{ item.orden.cliente.numero_documento }}</small>
            </td>
            <td>{{ item.orden.tecnico.nombre_completo }}</td>
            <td>{{ item.orden.descripcion_orden|truncatechars:50 }}</td>
            <td>
                <span class="badge {% if item.orden.estado == 'Pendiente' %}badge-warning{% else %}badge-success{% endif %}">
                    {{ item.orden.estado }}
                </span>
            </td>
            <td>{{ item.orden.fecha_creacion|date:"d/m/Y H:i" }}</td>
            <td>
                <span class="badge badge-info">{{ item.servicios_count }} servicios</span>
                {% if item.servicios %}
                <div class="related-data">
                    <strong>Servicios asociados:</strong>
                    {% for servicio in item.servicios %}
                    <div class="related-item">
                        <span>Servicio #{{ servicio.id_servicio_tecnico }}</span>
                    </div>
                    {% endfor %}
                </div>
                {% endif %}
            </td>
            <td>
                <span class="badge badge-primary">{{ item.facturas_count }} facturas</span>
                {% if item.facturas %}
                <div class="related-data">
                    <strong>Facturas:</strong>
                    {% for factura in item.facturas %}
                    <div class="related-item">
                        <span>Factura #{{ factura.id_recibo }}</span>
                        <span>{{ factura.fecha_factura }}</span>
                    </div>
                    {% endfor %}
                </div>
                {% endif %}
            </td>
            <td>
                <div class="action-buttons">
                    <button class="btn-sm btn-primary" 
                            onclick="viewOrderDetails('{{ item.orden.id_ordenServicio }}')" 
                            title="Ver detalles"
                            data-id="{{ item.orden.id_ordenServicio }}"
                            data-cliente="{{ item.orden.cliente.nombre }}"
                            data-tecnico="{{ item.orden.tecnico.nombre_completo }}"
                            data-descripcion="{{ item.orden.descripcion_orden }}"
                            data-estado="{{ item.orden.estado }}"
                            data-fecha="{{ item.orden.fecha_creacion|date:'d/m/Y H:i' }}"
                            data-servicios="{{ item.servicios_count }}"
                            data-facturas="{{ item.facturas_count }}">
                        <i class="fas fa-eye"></i>
                    </button>
                    {% if item.orden.estado == 'Pendiente' %}
                    <button class="btn-sm btn-success" 
                            onclick="completeOrder('{{ item.orden.id_ordenServicio }}')" 
                            title="Completar orden">
                        <i class="fas fa-check"></i>
                    </button>
                    {% endif %}
                    <button class="btn-sm btn-warning" 
                            onclick="editOrderRecord('{{ item.orden.id_ordenServicio }}')" 
                            title="Editar orden"
                            data-id="{{ item.orden.id_ordenServicio }}"
                            data-cliente="{{ item.orden.cliente.nombre }}"
                            data-tecnico="{{ item.orden.tecnico.nombre_completo }}"
                            data-descripcion="{{ item.orden.descripcion_orden }}"
                            data-estado="{{ item.orden.estado }}">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button class="btn-sm btn-danger" 
                            onclick="deleteOrderRecord('{{ item.orden.id_ordenServicio }}')" 
                            title="Eliminar orden"
                            data-id="{{ item.orden.id_ordenServicio }}"
                            data-cliente="{{ item.orden.cliente.nombre }}">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% else %}
<div class="empty-state">
    <i class="fas fa-clipboard-list"></i>
    <h3>No hay órdenes de servicio</h3>
    <p>Las órdenes de servicio aparecerán aquí.</p>
    <button class="btn-sm btn-primary" onclick="showAddOrderForm()">
        <i class="fas fa-plus"></i> Nueva Orden
    </button>
</div>
{% endif %}
{% endblock %}

{% block pagination %}
{% if ordenes_data.has_other_pages %}
<div class="pagination-container">
    <ul class="pagination">
        {% if ordenes_data.has_previous %}
            <li><a href="?page=1">&laquo; Primera</a></li>
            <li><a href="?page={{ ordenes_data.previous_page_number }}">Anterior</a></li>
        {% endif %}
        
        {% for num in ordenes_data.paginator.page_range %}
            {% if ordenes_data.number == num %}
                <li class="current">{{ num }}</li>
            {% elif num > ordenes_data.number|add:'-3' and num < ordenes_data.number|add:'3' %}
                <li><a href="?page={{ num }}">{{ num }}</a></li>
            {% endif %}
        {% endfor %}
        
        {% if ordenes_data.has_next %}
            <li><a href="?page={{ ordenes_data.next_page_number }}">Siguiente</a></li>
            <li><a href="?page={{ ordenes_data.paginator.num_pages }}">Última &raquo;</a></li>
        {% endif %}
    </ul>
</div>
{% endif %}
{% endblock %}

{% block extra_scripts %}
<script>
// Datos de ejemplo para órdenes de servicio
const ordenesData = {
    clientes: [
        { id: 1, nombre: 'Juan Pérez', documento: '12345678', telefono: '310-234-5678', email: 'juan@email.com' },
        { id: 2, nombre: 'María García', documento: '87654321', telefono: '320-876-5432', email: 'maria@email.com' },
        { id: 3, nombre: 'Carlos López', documento: '11223344', telefono: '315-567-8901', email: 'carlos@email.com' },
        { id: 4, nombre: 'Ana Rodríguez', documento: '44332211', telefono: '301-890-1234', email: 'ana@email.com' }
    ],
    tecnicos: [
        { id: 1, nombre: 'Roberto Martín', especialidad: 'Hardware', disponible: true },
        { id: 2, nombre: 'Sofia Chen', especialidad: 'Software', disponible: true },
        { id: 3, nombre: 'Miguel Santos', especialidad: 'Redes', disponible: false },
        { id: 4, nombre: 'Laura Vega', especialidad: 'Móviles', disponible: true }
    ],
    servicios: [
        { id: 1, tipo: 'Reparación de hardware', precio: 50000 },
        { id: 2, tipo: 'Instalación de software', precio: 30000 },
        { id: 3, tipo: 'Mantenimiento preventivo', precio: 40000 },
        { id: 4, tipo: 'Recuperación de datos', precio: 80000 },
        { id: 5, tipo: 'Configuración de red', precio: 60000 }
    ]
};

// Función para ver detalles de la orden
function viewOrderDetails(orderId) {
    const button = document.querySelector(\`[data-id="\${orderId}"]\`);
    const cliente = button.getAttribute('data-cliente');
    const tecnico = button.getAttribute('data-tecnico');
    const descripcion = button.getAttribute('data-descripcion');
    const estado = button.getAttribute('data-estado');
    const fecha = button.getAttribute('data-fecha');
    const servicios = button.getAttribute('data-servicios');
    const facturas = button.getAttribute('data-facturas');
    
    // Crear contenido del modal
    const modalContent = \`
        <div class="detail-header">
            <h3><i class="fas fa-clipboard-list"></i> Orden de Servicio #\${orderId}</h3>
            <span class="status-badge \${estado === 'Pendiente' ? 'status-pending' : 'status-completed'}">
                \${estado}
            </span>
        </div>
        
        <div class="detail-summary">
            <div class="summary-item">
                <i class="fas fa-user"></i>
                <span><strong>Cliente:</strong> \${cliente}</span>
            </div>
            <div class="summary-item">
                <i class="fas fa-tools"></i>
                <span><strong>Técnico:</strong> \${tecnico}</span>
            </div>
            <div class="summary-item">
                <i class="fas fa-calendar"></i>
                <span><strong>Fecha:</strong> \${fecha}</span>
            </div>
        </div>

        <div class="detail-categories">
            <div class="detail-category">
                <h4><i class="fas fa-clipboard-check"></i> Información de la Orden</h4>
                <div class="detail-grid">
                    <div class="detail-item">
                        <i class="fas fa-hashtag"></i>
                        <span><strong>ID Orden:</strong> #\${orderId}</span>
                    </div>
                    <div class="detail-item">
                        <i class="fas fa-align-left"></i>
                        <span><strong>Descripción:</strong> \${descripcion}</span>
                    </div>
                    <div class="detail-item">
                        <i class="fas fa-info-circle"></i>
                        <span><strong>Estado:</strong> <span class="\${estado === 'Pendiente' ? 'text-warning' : 'text-success'}">\${estado}</span></span>
                    </div>
                </div>
            </div>

            <div class="detail-category">
                <h4><i class="fas fa-cogs"></i> Servicios y Facturación</h4>
                <div class="detail-grid">
                    <div class="detail-item">
                        <i class="fas fa-list-ul"></i>
                        <span><strong>Servicios asociados:</strong> <span class="quantity-value">\${servicios}</span></span>
                    </div>
                    <div class="detail-item">
                        <i class="fas fa-file-invoice"></i>
                        <span><strong>Facturas generadas:</strong> <span class="quantity-value">\${facturas}</span></span>
                    </div>
                    <div class="detail-item">
                        <i class="fas fa-clock"></i>
                        <span><strong>Tiempo estimado:</strong> 2-4 horas</span>
                    </div>
                </div>
            </div>

            <div class="detail-category">
                <h4><i class="fas fa-user-tie"></i> Información del Cliente</h4>
                <div class="detail-grid">
                    <div class="detail-item">
                        <i class="fas fa-user"></i>
                        <span><strong>Nombre completo:</strong> \${cliente}</span>
                    </div>
                    <div class="detail-item">
                        <i class="fas fa-phone"></i>
                        <span><strong>Teléfono:</strong> <a href="tel:+57310234567" class="phone-link">310-234-5678</a></span>
                    </div>
                    <div class="detail-item">
                        <i class="fas fa-envelope"></i>
                        <span><strong>Email:</strong> <a href="mailto:cliente@email.com" class="email-link">cliente@email.com</a></span>
                    </div>
                </div>
            </div>

            <div class="detail-category">
                <h4><i class="fas fa-wrench"></i> Información del Técnico</h4>
                <div class="detail-grid">
                    <div class="detail-item">
                        <i class="fas fa-user-cog"></i>
                        <span><strong>Técnico asignado:</strong> \${tecnico}</span>
                    </div>
                    <div class="detail-item">
                        <i class="fas fa-star"></i>
                        <span><strong>Especialidad:</strong> Hardware y Software</span>
                    </div>
                    <div class="detail-item">
                        <i class="fas fa-check-circle"></i>
                        <span><strong>Estado:</strong> <span class="text-success">Disponible</span></span>
                    </div>
                </div>
            </div>
        </div>
    \`;
    
    // Mostrar en el modal existente
    const modal = document.getElementById('detailsModal');
    const modalBody = modal.querySelector('.modal-body');
    modalBody.innerHTML = modalContent;
    modal.style.display = 'flex';
}

// Función para editar orden
function editOrderRecord(orderId) {
    const button = document.querySelector(\`[data-id="\${orderId}"][onclick*="editOrderRecord"]\`);
    const cliente = button.getAttribute('data-cliente');
    const tecnico = button.getAttribute('data-tecnico');
    const descripcion = button.getAttribute('data-descripcion');
    const estado = button.getAttribute('data-estado');
    
    const editContent = \`
        <form id="editOrderForm">
            <div class="form-grid">
                <div class="form-group">
                    <label><i class="fas fa-user"></i> Cliente</label>
                    <select class="form-control" id="editClienteId" required>
                        <option value="">Seleccionar cliente...</option>
                        \${ordenesData.clientes.map(c => 
                            \`<option value="\${c.id}" \${c.nombre === cliente ? 'selected' : ''}>\${c.nombre}</option>\`
                        ).join('')}
                    </select>
                </div>
                
                <div class="form-group">
                    <label><i class="fas fa-user-cog"></i> Técnico Asignado</label>
                    <select class="form-control" id="editTecnicoId" required>
                        <option value="">Seleccionar técnico...</option>
                        \${ordenesData.tecnicos.map(t => 
                            \`<option value="\${t.id}" \${t.nombre === tecnico ? 'selected' : ''} \${!t.disponible ? 'disabled' : ''}>\${t.nombre} - \${t.especialidad}</option>\`
                        ).join('')}
                    </select>
                </div>
                
                <div class="form-group">
                    <label><i class="fas fa-align-left"></i> Descripción del Problema</label>
                    <textarea class="form-control" id="editDescripcion" rows="3" required>\${descripcion}</textarea>
                </div>
                
                <div class="form-group">
                    <label><i class="fas fa-info-circle"></i> Estado</label>
                    <select class="form-control" id="editEstado" required>
                        <option value="Pendiente" \${estado === 'Pendiente' ? 'selected' : ''}>Pendiente</option>
                        <option value="En Proceso" \${estado === 'En Proceso' ? 'selected' : ''}>En Proceso</option>
                        <option value="Completada" \${estado === 'Completada' ? 'selected' : ''}>Completada</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label><i class="fas fa-calendar"></i> Fecha de Entrega Estimada</label>
                    <input type="date" class="form-control" id="editFechaEntrega">
                </div>
                
                <div class="form-group">
                    <label><i class="fas fa-dollar-sign"></i> Costo Estimado</label>
                    <input type="number" class="form-control" id="editCosto" placeholder="Costo en COP">
                </div>
            </div>
        </form>
    \`;
    
    const modal = document.getElementById('editModal');
    const modalBody = modal.querySelector('.modal-body');
    modalBody.innerHTML = editContent;
    modal.style.display = 'flex';
    
    // Actualizar el botón de guardar
    const saveBtn = modal.querySelector('.btn-primary');
    saveBtn.onclick = () => saveOrderChanges(orderId);
}

// Función para eliminar orden
function deleteOrderRecord(orderId) {
    const button = document.querySelector(\`[data-id="\${orderId}"][onclick*="deleteOrderRecord"]\`);
    const cliente = button.getAttribute('data-cliente');
    
    const confirmContent = \`
        <div class="delete-confirmation">
            <div class="warning-icon">
                <i class="fas fa-exclamation-triangle"></i>
            </div>
            <h3>¿Eliminar Orden de Servicio?</h3>
            <p>Esta acción eliminará permanentemente:</p>
            <ul class="delete-details">
                <li><i class="fas fa-clipboard-list"></i> Orden #\${orderId}</li>
                <li><i class="fas fa-user"></i> Cliente: \${cliente}</li>
                <li><i class="fas fa-cogs"></i> Todos los servicios asociados</li>
                <li><i class="fas fa-file-invoice"></i> Histórico de facturación</li>
            </ul>
            <div class="warning-text">
                <strong>⚠️ Esta acción no se puede deshacer</strong>
            </div>
        </div>
    \`;
    
    const modal = document.getElementById('deleteModal');
    const modalBody = modal.querySelector('.modal-body');
    modalBody.innerHTML = confirmContent;
    modal.style.display = 'flex';
    
    // Actualizar el botón de confirmar
    const confirmBtn = modal.querySelector('.btn-danger');
    confirmBtn.onclick = () => confirmOrderDeletion(orderId);
}

// Función para completar orden
function completeOrder(orderId) {
    if (confirm(\`¿Marcar la orden #\${orderId} como completada?\`)) {
        showSuccessToast(\`✅ Orden #\${orderId} marcada como completada\`);
        
        // Simular actualización de estado
        setTimeout(() => {
            const button = document.querySelector(\`[onclick*="completeOrder('\${orderId}')"]\`);
            if (button) {
                button.remove();
            }
            location.reload();
        }, 1500);
    }
}

// Función para mostrar formulario de nueva orden
function showAddOrderForm() {
    const addContent = \`
        <form id="addOrderForm">
            <div class="form-grid">
                <div class="form-group">
                    <label><i class="fas fa-user"></i> Cliente *</label>
                    <select class="form-control" id="clienteId" required>
                        <option value="">Seleccionar cliente...</option>
                        \${ordenesData.clientes.map(cliente => 
                            \`<option value="\${cliente.id}">\${cliente.nombre} (\${cliente.documento})</option>\`
                        ).join('')}
                    </select>
                    <small class="form-text">O <a href="#" onclick="showNewClientForm()">crear nuevo cliente</a></small>
                </div>
                
                <div class="form-group">
                    <label><i class="fas fa-user-cog"></i> Técnico Asignado *</label>
                    <select class="form-control" id="tecnicoId" required>
                        <option value="">Seleccionar técnico...</option>
                        \${ordenesData.tecnicos.filter(t => t.disponible).map(tecnico => 
                            \`<option value="\${tecnico.id}">\${tecnico.nombre} - \${tecnico.especialidad}</option>\`
                        ).join('')}
                    </select>
                </div>
                
                <div class="form-group">
                    <label><i class="fas fa-align-left"></i> Descripción del Problema *</label>
                    <textarea class="form-control" id="descripcionOrden" rows="4" 
                              placeholder="Describe detalladamente el problema o servicio requerido..." required></textarea>
                </div>
                
                <div class="form-group">
                    <label><i class="fas fa-list-ul"></i> Tipo de Servicio</label>
                    <select class="form-control" id="tipoServicio" onchange="updateServicePrice()">
                        <option value="">Seleccionar tipo de servicio...</option>
                        \${ordenesData.servicios.map(servicio => 
                            \`<option value="\${servicio.id}" data-precio="\${servicio.precio}">\${servicio.tipo} - $\${servicio.precio.toLocaleString()}</option>\`
                        ).join('')}
                    </select>
                </div>
                
                <div class="form-group">
                    <label><i class="fas fa-calendar"></i> Fecha de Entrega Estimada</label>
                    <input type="date" class="form-control" id="fechaEntrega" min="\${new Date().toISOString().split('T')[0]}">
                </div>
                
                <div class="form-group">
                    <label><i class="fas fa-dollar-sign"></i> Costo Estimado</label>
                    <input type="number" class="form-control" id="costoEstimado" placeholder="Costo en COP" readonly>
                </div>
                
                <div class="form-group">
                    <label><i class="fas fa-exclamation-circle"></i> Prioridad</label>
                    <select class="form-control" id="prioridad">
                        <option value="Normal">Normal</option>
                        <option value="Alta">Alta</option>
                        <option value="Urgente">Urgente</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label><i class="fas fa-sticky-note"></i> Observaciones Adicionales</label>
                    <textarea class="form-control" id="observaciones" rows="2" 
                              placeholder="Observaciones, recomendaciones o notas especiales..."></textarea>
                </div>
            </div>
            
            <div class="service-summary" id="serviceSummary" style="display: none;">
                <h4><i class="fas fa-receipt"></i> Resumen del Servicio</h4>
                <div id="summaryContent"></div>
            </div>
        </form>
    \`;
    
    const modal = document.getElementById('addModal');
    const modalBody = modal.querySelector('.modal-body');
    modalBody.innerHTML = addContent;
    modal.style.display = 'flex';
    
    // Actualizar título del modal
    const modalTitle = modal.querySelector('h2');
    modalTitle.innerHTML = '<i class="fas fa-plus-circle"></i> Nueva Orden de Servicio';
}

// Función para actualizar precio del servicio
function updateServicePrice() {
    const select = document.getElementById('tipoServicio');
    const option = select.options[select.selectedIndex];
    const precio = option.getAttribute('data-precio');
    
    if (precio) {
        document.getElementById('costoEstimado').value = precio;
        showServiceSummary();
    } else {
        document.getElementById('costoEstimado').value = '';
        hideServiceSummary();
    }
}

// Función para mostrar resumen del servicio
function showServiceSummary() {
    const clienteSelect = document.getElementById('clienteId');
    const tecnicoSelect = document.getElementById('tecnicoId');
    const servicioSelect = document.getElementById('tipoServicio');
    
    if (clienteSelect.value && tecnicoSelect.value && servicioSelect.value) {
        const clienteNombre = clienteSelect.options[clienteSelect.selectedIndex].text;
        const tecnicoNombre = tecnicoSelect.options[tecnicoSelect.selectedIndex].text;
        const servicioNombre = servicioSelect.options[servicioSelect.selectedIndex].text;
        
        const summaryContent = \`
            <div class="summary-grid">
                <div class="summary-item">
                    <i class="fas fa-user"></i>
                    <span><strong>Cliente:</strong> \${clienteNombre}</span>
                </div>
                <div class="summary-item">
                    <i class="fas fa-user-cog"></i>
                    <span><strong>Técnico:</strong> \${tecnicoNombre}</span>
                </div>
                <div class="summary-item">
                    <i class="fas fa-cogs"></i>
                    <span><strong>Servicio:</strong> \${servicioNombre}</span>
                </div>
            </div>
        \`;
        
        document.getElementById('summaryContent').innerHTML = summaryContent;
        document.getElementById('serviceSummary').style.display = 'block';
    }
}

function hideServiceSummary() {
    document.getElementById('serviceSummary').style.display = 'none';
}

// Función para guardar nueva orden
function saveNewRecord() {
    const clienteId = document.getElementById('clienteId')?.value;
    const tecnicoId = document.getElementById('tecnicoId')?.value;
    const descripcion = document.getElementById('descripcionOrden')?.value;
    const tipoServicio = document.getElementById('tipoServicio')?.value;
    const costo = document.getElementById('costoEstimado')?.value;
    
    if (!clienteId || !tecnicoId || !descripcion) {
        showErrorToast('❌ Por favor completa todos los campos obligatorios (*)');
        return;
    }
    
    // Simular guardado
    const newOrderId = Math.floor(Math.random() * 1000) + 100;
    
    showSuccessToast(\`✅ Orden #\${newOrderId} creada exitosamente\`);
    
    setTimeout(() => {
        closeModal('addModal');
        location.reload();
    }, 2000);
}

// Función para guardar cambios de orden
function saveOrderChanges(orderId) {
    showSuccessToast(\`✅ Orden #\${orderId} actualizada correctamente\`);
    
    setTimeout(() => {
        closeModal('editModal');
        location.reload();
    }, 1500);
}

// Función para confirmar eliminación
function confirmOrderDeletion(orderId) {
    showSuccessToast(\`✅ Orden #\${orderId} eliminada correctamente\`);
    
    setTimeout(() => {
        closeModal('deleteModal');
        location.reload();
    }, 1500);
}

// Función para mostrar formulario de nuevo cliente
function showNewClientForm() {
    alert('Función de nuevo cliente - Redirigir a módulo de clientes');
}

// Funciones de notificación
function showSuccessToast(message) {
    const toast = document.createElement('div');
    toast.style.cssText = \`
        position: fixed;
        top: 20px;
        right: 20px;
        background: linear-gradient(135deg, #28a745, #20c997);
        color: white;
        padding: 15px 25px;
        border-radius: 10px;
        z-index: 10000;
        font-weight: 600;
        box-shadow: 0 5px 15px rgba(40, 167, 69, 0.3);
        animation: slideInRight 0.3s ease;
    \`;
    toast.innerHTML = message;
    document.body.appendChild(toast);
    
    setTimeout(() => {
        toast.remove();
    }, 4000);
}

function showErrorToast(message) {
    const toast = document.createElement('div');
    toast.style.cssText = \`
        position: fixed;
        top: 20px;
        right: 20px;
        background: linear-gradient(135deg, #dc3545, #c82333);
        color: white;
        padding: 15px 25px;
        border-radius: 10px;
        z-index: 10000;
        font-weight: 600;
        box-shadow: 0 5px 15px rgba(220, 53, 69, 0.3);
        animation: slideInRight 0.3s ease;
    \`;
    toast.innerHTML = message;
    document.body.appendChild(toast);
    
    setTimeout(() => {
        toast.remove();
    }, 4000);
}

// Agregar estilos CSS específicos
const orderStyles = document.createElement('style');
orderStyles.textContent = \`
    @keyframes slideInRight {
        from {
            transform: translateX(100%);
            opacity: 0;
        }
        to {
            transform: translateX(0);
            opacity: 1;
        }
    }
    
    .status-badge {
        padding: 6px 12px;
        border-radius: 20px;
        font-weight: 600;
        font-size: 0.85rem;
    }
    
    .status-pending {
        background: linear-gradient(135deg, #ffc107, #ff8f00);
        color: white;
    }
    
    .status-completed {
        background: linear-gradient(135deg, #28a745, #20c997);
        color: white;
    }
    
    .form-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
    }
    
    .service-summary {
        background: var(--bg-secondary);
        padding: 20px;
        border-radius: 10px;
        margin-top: 20px;
        border: 2px solid var(--primary-color);
    }
    
    .summary-grid {
        display: grid;
        grid-template-columns: 1fr;
        gap: 10px;
    }
    
    .summary-item {
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 8px;
        background: var(--bg-primary);
        border-radius: 6px;
    }
    
    .delete-confirmation {
        text-align: center;
    }
    
    .warning-icon {
        font-size: 3rem;
        color: #dc3545;
        margin-bottom: 15px;
    }
    
    .delete-details {
        list-style: none;
        padding: 0;
        margin: 20px 0;
    }
    
    .delete-details li {
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 8px;
        margin-bottom: 5px;
        background: var(--bg-secondary);
        border-radius: 6px;
    }
    
    .warning-text {
        background: #fff3cd;
        border: 1px solid #ffeaa7;
        color: #856404;
        padding: 10px;
        border-radius: 6px;
        margin-top: 15px;
    }
    
    .form-text {
        font-size: 0.8rem;
        color: var(--text-secondary);
        margin-top: 5px;
    }
    
    .form-text a {
        color: var(--primary-color);
        text-decoration: none;
    }
    
    .form-text a:hover {
        text-decoration: underline;
    }
    
    .text-warning {
        color: #ffc107 !important;
    }
    
    .text-success {
        color: #28a745 !important;
    }
\`;
document.head.appendChild(orderStyles);

// Mejorar la búsqueda para incluir campos específicos de órdenes
document.addEventListener('DOMContentLoaded', function() {
    // Override search function for order-specific searching
    const searchInput = document.getElementById('searchInput');
    if (searchInput) {
        searchInput.addEventListener('input', function() {
            const searchTerm = this.value.toLowerCase().trim();
            const rows = document.querySelectorAll('.data-table tbody tr');
            let visibleCount = 0;

            rows.forEach(row => {
                const cliente = row.cells[1]?.textContent.toLowerCase() || '';
                const tecnico = row.cells[2]?.textContent.toLowerCase() || '';
                const descripcion = row.cells[3]?.textContent.toLowerCase() || '';
                const estado = row.cells[4]?.textContent.toLowerCase() || '';
                const fecha = row.cells[5]?.textContent.toLowerCase() || '';
                const orderId = row.cells[0]?.textContent.toLowerCase() || '';

                const isVisible = orderId.includes(searchTerm) || 
                                cliente.includes(searchTerm) || 
                                tecnico.includes(searchTerm) || 
                                descripcion.includes(searchTerm) || 
                                estado.includes(searchTerm) || 
                                fecha.includes(searchTerm);

                if (isVisible) {
                    row.style.display = '';
                    visibleCount++;
                } else {
                    row.style.display = 'none';
                }
            });

            // Actualizar contador
            const counter = document.getElementById('resultsCount');
            if (counter) {
                counter.textContent = visibleCount;
            }
        });
    }
});
</script>
{% endblock %}