{% extends 'base_dashboard.html' %}
{% load static %}

{% block title %}Dashboard{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/dashboard-content.css' %}?v=2.0">
{% endblock %}

{% block content %}
<!-- Welcome Banner -->
<div class="welcome-banner">
    <h2>¬°Bienvenido, {{ user.get_full_name|default:user.username }}!</h2>
    {% if es_staff %}
    <p>Aqu√≠ est√° el resumen de tu sistema. Puedes acceder a todas las funcionalidades desde el men√∫ lateral.</p>
    {% else %}
    <p>Panel de cliente - Acceso limitado. Contacta al administrador para m√°s informaci√≥n.</p>
    {% endif %}
</div>

{% if es_staff %}

<!-- Mensaje de ayuda visual -->
<div class="alert alert-info" style="background: linear-gradient(135deg, #e3f2fd, #bbdefb); border-left: 4px solid #2196f3; margin-bottom: 20px; animation: pulse 2s infinite;">
    <div style="display: flex; align-items: center; gap: 15px;">
        <i class="fas fa-arrow-down" style="font-size: 2rem; color: #2196f3; animation: bounce 1s infinite;"></i>
        <div>
            <strong style="color: #1976d2;">üí° Consejo:</strong>
            <span style="color: #0d47a1;">Las secciones "Actividad Reciente" y "Tareas Pendientes" est√°n m√°s abajo. <strong>Despl√°zate hacia abajo</strong> para verlas.</span>
        </div>
    </div>
</div>

<style>
@keyframes bounce {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-10px); }
}
@keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.8; }
}
</style>

<!-- Stats Row - Solo para Staff -->
<div class="stats-row">
    <div class="stat-card primary">
        <div class="stat-icon">
            <i class="fas fa-users"></i>
        </div>
        <div class="stat-number">{{ total_clientes|default:0 }}</div>
        <div class="stat-label">Total Clientes</div>
        <div class="stat-trend up">
            <i class="fas fa-arrow-up"></i> Activos
        </div>
    </div>

    <div class="stat-card warning">
        <div class="stat-icon">
            <i class="fas fa-clipboard-list"></i>
        </div>
        <div class="stat-number">{{ ordenes_pendientes|default:0 }}</div>
        <div class="stat-label">√ìrdenes Pendientes</div>
        <div class="stat-trend">
            <i class="fas fa-clock"></i> En proceso
        </div>
    </div>

    <div class="stat-card success">
        <div class="stat-icon">
            <i class="fas fa-check-circle"></i>
        </div>
        <div class="stat-number">{{ ordenes_hoy|default:0 }}</div>
        <div class="stat-label">√ìrdenes Hoy</div>
        <div class="stat-trend up">
            <i class="fas fa-arrow-up"></i> Nuevas
        </div>
    </div>

    <div class="stat-card danger">
        <div class="stat-icon">
            <i class="fas fa-dollar-sign"></i>
        </div>
        <div class="stat-number">${{ ingresos_mes|default:0|floatformat:2 }}</div>
        <div class="stat-label">Ingresos del Mes</div>
        <div class="stat-trend up">
            <i class="fas fa-arrow-up"></i> +12%
        </div>
    </div>
</div>

<!-- Quick Actions -->
<div class="content-card">
    <h5>
        <i class="fas fa-bolt"></i> Acciones R√°pidas
    </h5>
    <div class="quick-actions">
        <a href="{% url 'clientes:lista' %}" class="quick-action">
            <i class="fas fa-user-plus"></i>
            <span>Nuevo Cliente</span>
        </a>
        <a href="{% url 'ordenes:lista' %}" class="quick-action">
            <i class="fas fa-plus-circle"></i>
            <span>Nueva Orden</span>
        </a>
        <a href="{% url 'productos:lista' %}" class="quick-action">
            <i class="fas fa-box"></i>
            <span>Nuevo Producto</span>
        </a>
        <a href="{% url 'ventas:lista' %}" class="quick-action">
            <i class="fas fa-file-invoice"></i>
            <span>Nueva Venta</span>
        </a>
    </div>
</div>

{% else %}
<!-- Contenido para Clientes -->
<div class="content-card">
    <h5>
        <i class="fas fa-info-circle"></i> Informaci√≥n de Cuenta
    </h5>
    <div class="info-box">
        <i class="fas fa-user-circle"></i>
        <div>
            <strong>Cuenta de Cliente</strong>
            <p class="mb-0">Bienvenido a DIGIT SOFT. Tu cuenta tiene acceso limitado. Para realizar compras o solicitar servicios, por favor contacta con nuestro equipo de ventas.</p>
        </div>
    </div>
    <div class="mt-4">
        <h6><i class="fas fa-envelope"></i> Contacto:</h6>
        <p>Email: ventas@digitsoft.com</p>
        <p>Tel√©fono: +52 123 456 7890</p>
    </div>
</div>

<div class="content-card mt-4">
    <h5>
        <i class="fas fa-lock"></i> Permisos de Acceso
    </h5>
    <div class="warning-box">
        <i class="fas fa-exclamation-triangle"></i>
        <div>
            <strong>Acceso Restringido</strong>
            <p class="mb-0">Como cliente, tu acceso a m√≥dulos administrativos est√° restringido. Solo el personal autorizado puede gestionar clientes, productos, ventas y otros m√≥dulos del sistema.</p>
        </div>
    </div>
</div>
{% endif %}

<!-- Activity & Tasks -->
{% if es_staff %}
<div class="row mt-4">
    <div class="col-lg-8">
        <div class="content-card" style="background: white; padding: 30px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.08); min-height: 400px;">
            <h5 class="mb-4" style="color: #2c3e50; font-weight: 600; border-bottom: 2px solid #ecf0f1; padding-bottom: 15px;">
                <i class="fas fa-chart-line"></i> Actividad Reciente
            </h5>

            <!-- Timeline de actividades -->
            <div class="activity-timeline" style="position: relative; padding-left: 40px;">
                <div class="activity-item" style="margin-bottom: 25px; display: flex; gap: 15px;">
                    <div class="activity-icon bg-success" style="width: 36px; height: 36px; border-radius: 50%; background: linear-gradient(135deg, #27ae60, #2ecc71); color: white; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
                        <i class="fas fa-user-plus"></i>
                    </div>
                    <div class="activity-content" style="flex: 1; background: #f8f9fa; border-radius: 10px; padding: 15px;">
                        <div class="activity-header" style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                            <strong style="color: #2c3e50;">Nuevo cliente registrado</strong>
                            <span class="activity-time" style="font-size: 0.8rem; color: #95a5a6;">Hace 2 horas</span>
                        </div>
                        <p class="activity-text mb-0" style="color: #7f8c8d; font-size: 0.9rem;">Cliente Web agregado al sistema</p>
                    </div>
                </div>

                <div class="activity-item" style="margin-bottom: 25px; display: flex; gap: 15px;">
                    <div class="activity-icon bg-primary" style="width: 36px; height: 36px; border-radius: 50%; background: linear-gradient(135deg, #037dc4, #0f9bec); color: white; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
                        <i class="fas fa-shopping-cart"></i>
                    </div>
                    <div class="activity-content" style="flex: 1; background: #f8f9fa; border-radius: 10px; padding: 15px;">
                        <div class="activity-header" style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                            <strong style="color: #2c3e50;">Nueva venta procesada</strong>
                            <span class="activity-time" style="font-size: 0.8rem; color: #95a5a6;">Hace 3 horas</span>
                        </div>
                        <p class="activity-text mb-0" style="color: #7f8c8d; font-size: 0.9rem;">Venta #{{ ultima_venta_numero|default:"VEN-001" }} - Total: ${{ ultima_venta_total|default:"0"|floatformat:2 }}</p>
                    </div>
                </div>

                <div class="activity-item" style="margin-bottom: 25px; display: flex; gap: 15px;">
                    <div class="activity-icon bg-info" style="width: 36px; height: 36px; border-radius: 50%; background: linear-gradient(135deg, #3498db, #5dade2); color: white; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
                        <i class="fas fa-box"></i>
                    </div>
                    <div class="activity-content" style="flex: 1; background: #f8f9fa; border-radius: 10px; padding: 15px;">
                        <div class="activity-header" style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                            <strong style="color: #2c3e50;">Inventario actualizado</strong>
                            <span class="activity-time" style="font-size: 0.8rem; color: #95a5a6;">Hace 5 horas</span>
                        </div>
                        <p class="activity-text mb-0" style="color: #7f8c8d; font-size: 0.9rem;">{{ productos_actualizados|default:"5" }} productos modificados</p>
                    </div>
                </div>

                <div class="activity-item" style="margin-bottom: 25px; display: flex; gap: 15px;">
                    <div class="activity-icon bg-warning" style="width: 36px; height: 36px; border-radius: 50%; background: linear-gradient(135deg, #f39c12, #f1c40f); color: white; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
                        <i class="fas fa-clipboard-list"></i>
                    </div>
                    <div class="activity-content" style="flex: 1; background: #f8f9fa; border-radius: 10px; padding: 15px;">
                        <div class="activity-header" style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                            <strong style="color: #2c3e50;">Orden de servicio completada</strong>
                            <span class="activity-time" style="font-size: 0.8rem; color: #95a5a6;">Hace 6 horas</span>
                        </div>
                        <p class="activity-text mb-0" style="color: #7f8c8d; font-size: 0.9rem;">Reparaci√≥n de equipo finalizada</p>
                    </div>
                </div>

                <div class="activity-item" style="margin-bottom: 25px; display: flex; gap: 15px;">
                    <div class="activity-icon bg-danger" style="width: 36px; height: 36px; border-radius: 50%; background: linear-gradient(135deg, #e74c3c, #ec7063); color: white; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
                        <i class="fas fa-file-invoice"></i>
                    </div>
                    <div class="activity-content" style="flex: 1; background: #f8f9fa; border-radius: 10px; padding: 15px;">
                        <div class="activity-header" style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                            <strong style="color: #2c3e50;">Factura generada</strong>
                            <span class="activity-time" style="font-size: 0.8rem; color: #95a5a6;">Ayer</span>
                        </div>
                        <p class="activity-text mb-0" style="color: #7f8c8d; font-size: 0.9rem;">Factura #{{ ultima_factura_numero|default:"FAC-001" }} emitida</p>
                    </div>
                </div>
            </div>

            <div class="text-center mt-3">
                <a href="{% url 'dashboard:index' %}" class="btn btn-sm btn-outline-primary">
                    Ver todas las actividades <i class="fas fa-arrow-right ms-1"></i>
                </a>
            </div>
        </div>
    </div>

    <div class="col-lg-4">
        <div class="content-card" style="background: white; padding: 30px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.08); min-height: 400px;">
            <h5 class="mb-4" style="color: #2c3e50; font-weight: 600; border-bottom: 2px solid #ecf0f1; padding-bottom: 15px;">
                <i class="fas fa-tasks"></i> Tareas Pendientes
            </h5>

            <!-- Lista de tareas -->
            <div class="tasks-list" style="display: flex; flex-direction: column; gap: 15px;">
                {% if ordenes_pendientes > 0 %}
                <div class="task-item priority-high" style="display: flex; gap: 15px; padding: 15px; background: linear-gradient(90deg, #ffebee, #f8f9fa); border-radius: 10px; border-left: 4px solid #e74c3c;">
                    <div class="task-icon" style="width: 40px; height: 40px; border-radius: 10px; background: rgba(231, 76, 60, 0.1); color: #e74c3c; display: flex; align-items: center; justify-content: center; font-size: 1.2rem; flex-shrink: 0;">
                        <i class="fas fa-wrench"></i>
                    </div>
                    <div class="task-content" style="flex: 1;">
                        <strong style="color: #2c3e50; font-size: 0.95rem; display: block; margin-bottom: 5px;">√ìrdenes pendientes</strong>
                        <p class="mb-0" style="color: #7f8c8d; font-size: 0.85rem; margin-bottom: 8px;">{{ ordenes_pendientes }} √≥rdenes por atender</p>
                        <a href="{% url 'ordenes:lista' %}" class="task-link" style="color: #037dc4; font-size: 0.85rem; text-decoration: none; font-weight: 500;">Ver √≥rdenes ‚Üí</a>
                    </div>
                </div>
                {% endif %}

                <div class="task-item priority-medium" style="display: flex; gap: 15px; padding: 15px; background: linear-gradient(90deg, #fff3e0, #f8f9fa); border-radius: 10px; border-left: 4px solid #f39c12;">
                    <div class="task-icon" style="width: 40px; height: 40px; border-radius: 10px; background: rgba(243, 156, 18, 0.1); color: #f39c12; display: flex; align-items: center; justify-content: center; font-size: 1.2rem; flex-shrink: 0;">
                        <i class="fas fa-boxes"></i>
                    </div>
                    <div class="task-content" style="flex: 1;">
                        <strong style="color: #2c3e50; font-size: 0.95rem; display: block; margin-bottom: 5px;">Stock bajo</strong>
                        <p class="mb-0" style="color: #7f8c8d; font-size: 0.85rem; margin-bottom: 8px;">Revisar inventario de productos</p>
                        <a href="{% url 'productos:lista' %}" class="task-link" style="color: #037dc4; font-size: 0.85rem; text-decoration: none; font-weight: 500;">Ver productos ‚Üí</a>
                    </div>
                </div>

                <div class="task-item priority-low" style="display: flex; gap: 15px; padding: 15px; background: linear-gradient(90deg, #e3f2fd, #f8f9fa); border-radius: 10px; border-left: 4px solid #3498db;">
                    <div class="task-icon" style="width: 40px; height: 40px; border-radius: 10px; background: rgba(52, 152, 219, 0.1); color: #3498db; display: flex; align-items: center; justify-content: center; font-size: 1.2rem; flex-shrink: 0;">
                        <i class="fas fa-file-alt"></i>
                    </div>
                    <div class="task-content" style="flex: 1;">
                        <strong style="color: #2c3e50; font-size: 0.95rem; display: block; margin-bottom: 5px;">Reportes mensuales</strong>
                        <p class="mb-0" style="color: #7f8c8d; font-size: 0.85rem; margin-bottom: 8px;">Generar reporte de ventas</p>
                        <a href="{% url 'ventas:lista' %}" class="task-link" style="color: #037dc4; font-size: 0.85rem; text-decoration: none; font-weight: 500;">Ir a ventas ‚Üí</a>
                    </div>
                </div>

                <div class="task-item priority-low" style="display: flex; gap: 15px; padding: 15px; background: linear-gradient(90deg, #e3f2fd, #f8f9fa); border-radius: 10px; border-left: 4px solid #3498db;">
                    <div class="task-icon" style="width: 40px; height: 40px; border-radius: 10px; background: rgba(52, 152, 219, 0.1); color: #3498db; display: flex; align-items: center; justify-content: center; font-size: 1.2rem; flex-shrink: 0;">
                        <i class="fas fa-users"></i>
                    </div>
                    <div class="task-content" style="flex: 1;">
                        <strong style="color: #2c3e50; font-size: 0.95rem; display: block; margin-bottom: 5px;">Seguimiento clientes</strong>
                        <p class="mb-0" style="color: #7f8c8d; font-size: 0.85rem; margin-bottom: 8px;">Contactar clientes inactivos</p>
                        <a href="{% url 'clientes:lista' %}" class="task-link" style="color: #037dc4; font-size: 0.85rem; text-decoration: none; font-weight: 500;">Ver clientes ‚Üí</a>
                    </div>
                </div>
            </div>

            <div class="mt-3 p-3 bg-light rounded" style="margin-top: 1rem; padding: 1rem; background-color: #f8f9fa; border-radius: 0.5rem;">
                <small class="text-muted d-block mb-2" style="color: #6c757d; display: block; margin-bottom: 0.5rem;">
                    <i class="fas fa-calendar-check"></i> <strong>Recordatorio:</strong>
                </small>
                <small class="text-muted" style="color: #6c757d;">
                    No olvides revisar las √≥rdenes pendientes y actualizar el inventario diariamente.
                </small>
            </div>
        </div>
    </div>
</div>
{% endif %}
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/dashboard.js' %}"></script>
{% endblock %}

