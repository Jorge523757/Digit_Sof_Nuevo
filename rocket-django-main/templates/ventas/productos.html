{% extends 'base.html' %}
{% block content %}
<h1>Productos</h1>
<form method="get">
    <input type="text" name="q" placeholder="Buscar..." value="{{ query }}">
    <button type="submit">Buscar</button>
    <a href="{% url 'ventas:crear_producto' %}">Agregar producto</a>
</form>
<table border="1">
    <tr>
        <th>Imagen</th><th>Nombre</th><th>Descripción</th><th>Precio</th><th>Stock</th><th>Acciones</th>
    </tr>
    {% for producto in productos %}
    <tr>
        <td>{% if producto.imagen %}<img src="{{ producto.imagen.url }}" width="60">{% endif %}</td>
        <td><a href="{% url 'ventas:detalle_producto' producto.pk %}">{{ producto.nombre }}</a></td>
        <td>{{ producto.descripcion|truncatechars:50 }}</td>
        <td>${{ producto.precio }}</td>
        <td>{% if producto.stock <= 3 %}<span style="color:red">{{ producto.stock }} (¡Por agotarse!)</span>{% else %}{{ producto.stock }}{% endif %}</td>
        <td>
            <a href="{% url 'ventas:editar_producto' producto.pk %}">Editar</a> |
            <a href="{% url 'ventas:eliminar_producto' producto.pk %}">Eliminar</a> |
            <a href="{% url 'ventas:agregar_al_carrito' producto.pk %}">Agregar al carrito</a>
        </td>
    </tr>
    {% endfor %}
</table>
<a href="{% url 'ventas:ver_carrito' %}">Ver carrito</a>
{% endblock %}
